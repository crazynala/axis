# TODO / Next Steps (2025-09-11)

## 1. Legacy Field Migration (componentId -> productId)

- [ ] costings index: `componentId` still present (form state & columns) – needs conversion to `productId` (grep confirmed lines 98,106,178,180).
- [ ] costing detail route: verify removal of `componentId` (grep shows none; tentatively Done pending manual spot-check).
- [ ] jobs assembly nested route: still dual handling (lines ~192–193) – remove fallback once upstream forms emit only `productId`.
- [ ] import script `importCostings.ts` still mapping `ComponentId` – adjust to map to `productId` only (keep legacy alias temporarily with warning).

Status: PARTIAL – core model migrated but UI & importer cleanup outstanding.

## 2. Remove Deprecated `usageType`

- [ ] costings index still references `usageType` (lines 101,109,182) – remove & substitute with `activityUsed` if needed.
- [ ] costing list/detail: `costings.tsx` still selects `usageType` – update query.
- [ ] `AssemblyActivityModal` still filters by `usageType` lines 147–148 – switch to `activityUsed` or remove filter.
- [ ] Remove interface remnants declaring `usageType`.

Status: IN PROGRESS – mixed usage remains.

## 3. Costings Enhancements

- [ ] Add `activityUsed` column (currently only searchable; not displayed).
- [ ] Extended cost column (quantityPerUnit \* unitCost) – compute server-side for sorting or client render.
- [ ] Saved view presets (assembly/product/activity).

Status: NOT STARTED.

## 4. Table / Navigation Consistency

- [ ] Migrate admin DHL records (`admin.dhl-records._index.tsx`) – still imports raw `DataTable`.
- [ ] Confirm forex admin route existence & migrate if present (grep not yet performed).
- [ ] Apply `buildRowNavHandlers` to remaining tables with manual `onRowClick` (audit needed).
- [ ] Replace ad-hoc money/date renderers with helpers in invoices, shipments, products indexes.

Status: PARTIAL – core business tables migrated; admin backlog remains.

## 5. Money Formatting Standardization

- [ ] Create `formatMoney` helper (not found via grep).
- [ ] Sweep for `(x ?? 0).toFixed(2)` / `.toFixed(2)` patterns and replace.
- [ ] Plan optional currency localization layer.

Status: NOT STARTED.

## 6. Find / Multi-Find System Polishing

- [ ] Add interpreter key for `activityUsed` (searchableFields updated but advanced find config not verified).
- [ ] Expose money fields with consistent filter ops (range: min/max).
- [ ] Add tests for multi-request omit logic with new fields.

Status: NOT STARTED.

## 7. Type Safety & Cleanup

- [ ] Re-scan for `as any` (scope not yet audited post-migrations).
- [ ] Add `TableColumn<T>` generic & tighten helper return types.
- [ ] Introduce `type LoaderRows<T> = Awaited<ReturnType<typeof loader>>['rows']` pattern or utility for reuse.

Status: NOT STARTED.

## 8. Performance / UX

- [ ] Prefetch next page dataset.
- [ ] Debounced search submissions.
- [ ] Optimistic focus highlight.

Status: NOT STARTED.

## 9. Accessibility

- [ ] ARIA live region for page/record summary.
- [ ] Verify focus outline contrast.
- [ ] Document keyboard shortcuts.

Status: NOT STARTED.

## 10. Documentation

- [ ] Update find pattern doc with `activityUsed` & money filters.
- [ ] Add `table-helpers.md` doc.
- [ ] Add formatting guidelines doc/section.

Status: NOT STARTED.

## 11. Testing

- [ ] Keyboard nav smoke tests.
- [ ] Multi-find engine edge case tests.
- [ ] Costings seed data for `activityUsed`.

Status: NOT STARTED.

## 12. Nice-to-Have Enhancements

- [ ] Column visibility persistence.
- [ ] Quick filter chips from cell values.
- [ ] CSV export honoring multi-find semantics.

Status: NOT STARTED.

---

Generated automatically based on current codebase state and recent migration/refactor prompts.
