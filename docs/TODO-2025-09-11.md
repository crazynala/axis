# TODO / Next Steps (2025-09-11)

## 1. Legacy Field Migration (componentId -> productId)

- [ ] Remove remaining `componentId` occurrences still present in `costings._index.tsx` form state & columns (ensure already-refactored logic matches schema with `productId`).
- [ ] Update any detail/edit routes referencing `componentId` (e.g. costing detail page if still present in `costings.$id.tsx`).
- [ ] Audit job assembly nested route (`jobs.$jobId.assembly.$assemblyId.tsx`) – consolidate temporary dual handling of `productId` / `componentId` once all forms send only `productId`.
- [ ] Search server utilities / import scripts for `componentId` and refactor.

## 2. Remove Deprecated `usageType`

- [ ] Eliminate `usageType` form fields, filters, and columns lingering in costings routes (some references still appear in `costings._index.tsx`, `costings.tsx`, `AssemblyActivityModal` filtering logic, etc.).
- [ ] Replace any logic conditional on `usageType` with `activityUsed` or other current fields.
- [ ] Clean up schema commentary where `usageType` was referenced to avoid confusion.

## 3. Costings Enhancements

- [ ] Add `activityUsed` column to `costings._index.tsx` (after confirming it is reliably populated) using `simpleColumn("activityUsed", "Activity")`.
- [ ] Consider a derived display column combining quantity + unitCost (e.g., extended cost) if valuable.
- [ ] Add saved view presets for common costing filters (by assembly, by product, by activityUsed).

## 4. Table / Navigation Consistency

- [ ] Migrate remaining admin tables still using raw `DataTable`:
  - `admin.forex.$fromCurrency.$toCurrency.tsx`
  - `admin.dhl-records._index.tsx`
- [ ] Apply `buildRowNavHandlers` to all index routes already on `NavDataTable` that still have inline handlers.
- [ ] Standardize column helper usage across invoices, shipments, products where ad‑hoc renderers persist.

## 5. Money Formatting Standardization

- [ ] Introduce `formatMoney(value: number | null | undefined, currency = 'USD')` in a new `app/utils/format.ts`.
- [ ] Replace inline `(x ?? 0).toFixed(2)` across purchase orders, expenses, invoices, shipments, costings with the helper.
- [ ] Consider localization / currency hints later (multi-currency support backlog item).

## 6. Find / Multi-Find System Polishing

- [ ] Ensure new columns (`activityUsed`, money fields) are eligible for quick filtering where appropriate.
- [ ] Add interpreter entries for `activityUsed` if advanced find should support it.
- [ ] Add unit tests (or minimal integration tests) for multi-find translation edge cases.

## 7. Type Safety & Cleanup

- [ ] Remove any residual `as any` casts introduced during transition (re-scan `app/routes` + `app/components`).
- [ ] Strengthen column helper typings: export a `TableColumn<T>` generic tying `accessor` to key of T.
- [ ] Provide shared `RowType<TLoader>` inference helper to reduce repeated `rows as any` casts in routes.

## 8. Performance / UX

- [ ] Consider server-side pagination prefetch (preload next page IDs) for large tables.
- [ ] Debounce search / filter submissions to reduce rapid reloads.
- [ ] Implement optimistic row highlight when navigating via keyboard before loader completes.

## 9. Accessibility

- [ ] Add ARIA live region for row count updates when paging.
- [ ] Ensure focus outline meets contrast guidelines after custom styling.
- [ ] Provide skip-to-table keyboard shortcut documentation in README.

## 10. Documentation

- [ ] Update `docs/find-pattern.md` with any new interpreter keys (`activityUsed`).
- [ ] Add `docs/table-helpers.md` covering `NavDataTable`, column factories, and row handler utility.
- [ ] Document money formatting approach and rationale for avoiding ad-hoc `toFixed`.

## 11. Testing

- [ ] Add smoke tests for each migrated index route verifying basic keyboard navigation (focus first row, arrow navigation, Enter opens detail).
- [ ] Add prisma seed snippet to generate sample costings with `activityUsed` for test predictability.

## 12. Nice-to-Have Enhancements

- [ ] Column visibility toggles persisted per view.
- [ ] Inline quick filter chips generated from selected cell values.
- [ ] Export current view (CSV) respecting active multi-find logic.

---

Generated automatically based on current codebase state and recent migration/refactor prompts.
